
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../code/">
      
      
        <link rel="next" href="../technical_documentation/">
      
      <link rel="icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAZJDP/K0Ba/xkkM/8ZJDP/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABkkM/8ZJDP/K0FZ9itAWv8ZJDP/FiEt9BkkM/8ZJDP/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGSQz/xkkM/8qQFn2JDRL/yY4T/83UG//HCg4/xsnOP8mKjP/FiEt9BkkM/8ZJDP/AAAAAAAAAAAAAAAAGSQz/xkkM/8fLD7/Kj5W/yY5Uf8hMUb/ITNL/xsmNv8eKzz/IS9B/xgjMv8YIzL/FiAs9BkkM/8AAAAAAAAAAC1DXf8fLUL/LEFb/y9AVv83UG//N1Bv/yQ1TP8bJzf/IzNH/yAvQ/8cJjP/Exwp/x8sP/8VHyzxAAAAAAAAAAAkNUv/L0Vf/yxBXP8jNUz/K0Fa/yM0S/8uRV//GSY2/x8tP/8THCn/HCk6/xwoN/8cKTn/HCg48QAAAAAAAAAALkRe/yM0S/8oPFT/JTZN/y9FYP8jNEr/IzRL/xQdKv8mLzn/FyIx/xklNP8YIjH/IzFB/w8XIvEAAAAAAAAAAC5DXf83UG//LT5V/y1BXP8eLUP/JDVN/xkhNv8jKyv/GSMz/xciMP8aJjb/IC9B/xgjMv8XIi/xAAAAAAAAAAA5UXL/KT1W/ytAWf8hRUP/Mm9N/xtBOf8oa0P/HEgu/xlEKv8TIib/ER8k/xwjLf8dKjv/Gyc18QAAAAAAAAAAKTxU/ys9WP8eOzr/IlU+/zl2Vv8+hV7/XbaK/z2gZP8gUDL/GUUr/yBNMv8cQC7/HCk5/xsnN/EAAAAAAAAAAC5WSf89eFv/IUk9/zSAUv9Fpm7/TKt3/0+sev9Ep2v/RaRw/1Cwef8nVjr/H0ox/xZDJ/8RGSXxAAAAAAAAAAAucUn/Nn5V/zyeY/9HonD/RqZv/0undP9OqHn/QqFs/0Klaf9Eo2z/S6xz/0Cgaf8bSy3/GD4n8QAAAAAAAAAANZZd/0Oma/9QqX3/QKRo/1Svfv9KqHT/NJdc/1+4i/9Hqm//Op1i/zKVWf81ll3/NZZd/zWWXf8AAAAAAAAAAAAAAAA1ll3/NZZd/zudYvs5m2H/P59n/zebXv9KpXP/U65+/zCTV/8yllr/NZZd/zWWXf8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA1ll3/NZZd/zufY/85nGD/P6Fm/zqcYP86nGD/NZZd/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA1ll3/OZxg/zmcYP81ll3/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/D8AAPAPAADAAwAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAMADAADwDwAA/D8AAA==">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.20">
    
    
      
        <title>System Requirements - IoT - Students' Portfolio</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.eebd395e.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
	<link rel="stylesheet" href="../../assets/stylesheets/mdocotion.css" />
	<script src="../../assets/javascripts/mdocotion.js"></script>

  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#system-requirements" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
     
	
<header class="md-header" data-md-component="header">

	<div class="header-inner">
		<div class="header-info-bar">
			<label class="md-header__button md-icon" for="__drawer"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label>

			<ul class="mdocotion-breadcrumbs">
			</ul>
		</div>

		<ul class="mdocotion-header-nav">
			<li>
				
				<label class="md-header__button md-icon" for="__search"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label>
				<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div> 
			</li>
		</ul>
	</div>
</header> 

    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
	
		
		
			<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation"  style="background: #f1f5f9;">
		
	
		<div class="md-sidebar__scrollwrap">
			<div class="md-sidebar__inner">
			  
<div class="mdocotion-nav-header">
	<div class="mdocotion-nav-logo">
		<a href="../.." >
			
  <img src="../../assets/logo.svg" alt="logo">

		</a>
		</div>
	
		IoT - Students' Portfolio
	
</div>
<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
	<ul class="md-nav__list" data-md-scrollfix>
		   

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        üèöÔ∏è Home
      </a>
    </li>
  
    

  
  
  
    <li class="md-nav__item">
      <a href="../../system_architecture" class="md-nav__link">
        üì¶ System Architecture
      </a>
    </li>
  
    

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        
        <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
            <span class="md-nav__icon md-icon"></span>
            
                üß∞ Embedded
            
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          <a href="../..">üß∞ Embedded</a>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="." class="md-nav__link">
        Requirements
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../technical_documentation" class="md-nav__link">
        Technical documentation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../code" class="md-nav__link">
        Code
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
    

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        
        <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
            <span class="md-nav__icon md-icon"></span>
            
                üåê Web
            
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          <a href="../..">üåê Web</a>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../web/technical_documentation" class="md-nav__link">
        Technical documentation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../web/api_reference" class="md-nav__link">
        API reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../web/code" class="md-nav__link">
        Code
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../web/database" class="md-nav__link">
        Database
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
    

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        
        <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
            <span class="md-nav__icon md-icon"></span>
            
                üë©‚Äçüé® User Experience Design
            
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          <a href="../..">üë©‚Äçüé® User Experience Design</a>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
      
      
      
        
        <label class="md-nav__link " for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            <span class="md-nav__icon md-icon"></span>
            
                Concept & Design
            
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_1">
          <span class="md-nav__icon md-icon"></span>
          <a href="../..">Concept & Design</a>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../uxd/concept" class="md-nav__link">
        Concept
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../uxd/design" class="md-nav__link">
        Design
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../uxd/create_test" class="md-nav__link">
        Create & Test
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../uxd/conclude_reflect" class="md-nav__link">
        Conclude & Reflect
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
    

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        
        <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
            <span class="md-nav__icon md-icon"></span>
            
                üîé Research
            
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          <a href="../..">üîé Research</a>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research/research" class="md-nav__link">
        Research to Market
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../research/research-implementation" class="md-nav__link">
        Research to Market: Implementation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
 
	</ul>
</nav>
			</div>
		</div>
		</div>
	

          

	<div class="md-content" data-md-component="content">

	<article class="mdocotion-content md-content__inner md-typeset">
		<div class="mdocotion-content-scroller">
			<main class="mdocotion-content-view">
				<div class="mdocotion-content-block">
					<div class="mdocotion-content-block-inner"> 


<div><h1 id="system-requirements">System Requirements</h1>
<p>To build the embedded device, the following requirements from DLO must be fulfilled:</p>
<table>
<thead>
<tr>
<th>Requirement ID#</th>
<th>Requirement</th>
<th>MoSCoW</th>
<th>Compliant</th>
</tr>
</thead>
<tbody>
<tr>
<td>EMBRQ#01</td>
<td>The embedded device acts as a client and sends measured sensor data to the application backend over http or https.</td>
<td>MUST</td>
<td>YES</td>
</tr>
<tr>
<td>EMBRQ#02</td>
<td>The embedded device also acts as a server and receives status messages from the application backend over http or https.</td>
<td>MUST</td>
<td>YES</td>
</tr>
<tr>
<td>EMBRQ#03</td>
<td>The embedded device contains at least two types of input sensors (e.g. LDR, buttons, joystick, capacitive touch, etc.).</td>
<td>MUST</td>
<td>YES</td>
</tr>
<tr>
<td>EMBRQ#04</td>
<td>The embedded device contains at least two types of visual and/or sensory outputs (e.g. LED, LED Matrix, 7-segment display, motor, servo, actuator, LCD-screen, buzzer, etc.).</td>
<td>MUST</td>
<td>YES</td>
</tr>
<tr>
<td>EMBRQ#05</td>
<td>The embedded device uses the WifiManager for configuration of SSID and password (PWD) for connecting to the network.</td>
<td>MUST</td>
<td>YES</td>
</tr>
</tbody>
</table>
<h2 id="embrq01-proof-of-https-api-access-from-devices">EMBRQ#01 ‚Äî Proof of HTTPS API Access from Devices</h2>
<p>Both devices can access the API via <code>https://yanisdeplazes.loca.lt</code> using HTTPS requests.
They can fetch data using <code>GET</code> and upload sensor readings using <code>POST</code>.</p>
<hr>
<h3 id="get-fetch-devices">GET: Fetch Devices</h3>
<p><strong>File:</strong> <code>Client.cpp</code> ‚Äî Line 165 <a href="https://github.com/YanisDeplazes/atmos/tree/main/embedded/final/sensors/Client.cpp?ref_type=heads#L165">Source</a></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">String</span><span class="w"> </span><span class="n">raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">httpGET</span><span class="p">(</span><span class="s">"/api/device"</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<h3 id="get-latest-reading-for-device">GET: Latest Reading for Device</h3>
<p><strong>File:</strong> <code>Client.cpp</code> ‚Äî Line 202 <a href="https://github.com/YanisDeplazes/atmos/tree/main/embedded/final/installation/Client.cpp?ref_type=heads#L202">Source</a></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">String</span><span class="w"> </span><span class="n">raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">httpGET</span><span class="p">(</span><span class="s">"/api/views/LatestDeviceReadings?device_id=1"</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<h3 id="post-register-device">POST: Register Device</h3>
<p><strong>File:</strong> <code>Client.cpp</code> ‚Äî Line 208 <a href="https://github.com/YanisDeplazes/atmos/tree/main/embedded/final/sensors/Client.cpp?ref_type=heads#L208">Source</a></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">StaticJsonDocument</span><span class="o">&lt;</span><span class="mi">128</span><span class="o">&gt;</span><span class="w"> </span><span class="n">doc</span><span class="p">;</span>
<span class="n">doc</span><span class="p">[</span><span class="s">"key"</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mac</span><span class="p">;</span>
<span class="n">doc</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Weather Station"</span><span class="p">;</span>

<span class="n">String</span><span class="w"> </span><span class="n">payload</span><span class="p">;</span>
<span class="n">serializeJson</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span><span class="w"> </span><span class="n">payload</span><span class="p">);</span>
<span class="n">httpPOST</span><span class="p">(</span><span class="s">"/api/device"</span><span class="p">,</span><span class="w"> </span><span class="n">payload</span><span class="p">,</span><span class="w"> </span><span class="s">"application/json"</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<h3 id="post-send-reading-sensor-data">POST: Send Reading + Sensor Data</h3>
<p><strong>File:</strong> <code>Client.cpp</code> ‚Äî Line 258 <a href="https://github.com/YanisDeplazes/atmos/tree/main/embedded/final/sensors/Client.cpp?ref_type=heads#L258">Source</a></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">StaticJsonDocument</span><span class="o">&lt;</span><span class="mi">1024</span><span class="o">&gt;</span><span class="w"> </span><span class="n">doc</span><span class="p">;</span>
<span class="n">doc</span><span class="p">[</span><span class="s">"device_id"</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deviceId</span><span class="p">;</span>
<span class="n">JsonArray</span><span class="w"> </span><span class="n">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">doc</span><span class="p">.</span><span class="n">createNestedArray</span><span class="p">(</span><span class="s">"sensor_data"</span><span class="p">);</span>

<span class="n">JsonObject</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arr</span><span class="p">.</span><span class="n">createNestedObject</span><span class="p">();</span>
<span class="n">obj</span><span class="p">[</span><span class="s">"sensor_id"</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">obj</span><span class="p">[</span><span class="s">"value"</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">24.5</span><span class="p">;</span>

<span class="n">String</span><span class="w"> </span><span class="n">payload</span><span class="p">;</span>
<span class="n">serializeJson</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span><span class="w"> </span><span class="n">payload</span><span class="p">);</span>
<span class="n">httpPOST</span><span class="p">(</span><span class="s">"/api/reading-with-sensordata"</span><span class="p">,</span><span class="w"> </span><span class="n">payload</span><span class="p">,</span><span class="w"> </span><span class="s">"application/json"</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<h3 id="used-libraries">Used Libraries</h3>
<ul>
<li><code>WiFiClientSecure</code> for HTTPS</li>
<li><code>ArduinoJson</code> for JSON handling</li>
</ul>
<p>All traffic to and from the device is encrypted and uses HTTPS.</p>
<h2 id="embrq02">EMBRQ#02</h2>
<p>The ESP32 device hosts a HTTPS server using a self-signed certificate.
It exposes the <code>/index</code> route to get the current index of what device is currently displayed for a fallback.</p>
<h3 id="get-index-endpoint">GET: /index Endpoint</h3>
<p><strong>File:</strong> <code>server.cpp</code> ‚Äî Line ~45 <a href="https://github.com/YanisDeplazes/atmos/tree/main/embedded/final/installation/Server.cpp?ref_type=heads#L45">Source</a></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">esp_err_t</span><span class="w"> </span><span class="nf">handle_index</span><span class="p">(</span><span class="n">httpd_req_t</span><span class="w"> </span><span class="o">*</span><span class="n">req</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">resp_str</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
<span class="w">    </span><span class="n">snprintf</span><span class="p">(</span><span class="n">resp_str</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">resp_str</span><span class="p">),</span><span class="w"> </span><span class="s">"{</span><span class="se">\"</span><span class="s">index</span><span class="se">\"</span><span class="s">: %d}"</span><span class="p">,</span><span class="w"> </span><span class="n">currentIndex</span><span class="p">);</span>

<span class="w">    </span><span class="n">httpd_resp_set_type</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="s">"application/json"</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">httpd_resp_send</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">resp_str</span><span class="p">,</span><span class="w"> </span><span class="n">HTTPD_RESP_USE_STRLEN</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="https-server-setup">HTTPS Server Setup</h3>
<p><strong>File:</strong> <code>server.cpp</code> ‚Äî Line ~63 <a href="https://github.com/YanisDeplazes/atmos/tree/main/embedded/final/installation/Server.cpp?ref_type=heads#L63">Source</a></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">httpd_ssl_config_t</span><span class="w"> </span><span class="n">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HTTPD_SSL_CONFIG_DEFAULT</span><span class="p">();</span>
<span class="n">conf</span><span class="p">.</span><span class="n">servercert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">server_cert</span><span class="p">;</span>
<span class="n">conf</span><span class="p">.</span><span class="n">servercert_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">server_cert</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">conf</span><span class="p">.</span><span class="n">prvtkey_pem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">server_key</span><span class="p">;</span>
<span class="n">conf</span><span class="p">.</span><span class="n">prvtkey_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">server_key</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="n">esp_err_t</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">httpd_ssl_start</span><span class="p">(</span><span class="o">&amp;</span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">conf</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<h3 id="used-libraries_1">Used Libraries</h3>
<ul>
<li><code>httpd_ssl</code> from ESP-IDF for TLS web server</li>
<li><code>esp_tls</code> for certificate handling</li>
<li>Custom <code>cert.h</code> and <code>key.h</code> headers for in-memory PEM cert and key</li>
</ul>
<h3 id="nginx-settings">NGINX Settings</h3>
<p>The system uses NGINX's Push Stream Module to broadcast the current index when it changes.
The subscribed client (IPad or Browser) can receive real-time updates over the WebSocket-like connection.</p>
<p><strong>File:</strong> <code>nginx.conf</code> ‚Äî Line ~51 <a href="https://github.com/YanisDeplazes/atmos/tree/main/docker/config/nginx/nginx.conf#L51">Source</a></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">    </span><span class="n">location</span><span class="w"> </span><span class="o">^~</span><span class="w"> </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">installation</span><span class="o">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">rewrite</span><span class="w"> </span><span class="o">^/</span><span class="n">api</span><span class="o">/</span><span class="n">installation</span><span class="p">(</span><span class="o">/</span><span class="p">.</span><span class="o">*</span><span class="p">)</span><span class="n">$</span><span class="w"> </span><span class="n">$1</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="n">proxy_pass</span><span class="w"> </span><span class="n">https</span><span class="o">:</span><span class="c1">//100.74.255.21; // Hardcoded: not optimal</span>
<span class="w">            </span><span class="n">proxy_ssl_verify</span><span class="w"> </span><span class="n">off</span><span class="p">;</span>
<span class="w">            </span><span class="n">proxy_set_header</span><span class="w"> </span><span class="n">Host</span><span class="w"> </span><span class="n">$host</span><span class="p">;</span>
<span class="w">            </span><span class="n">proxy_set_header</span><span class="w"> </span><span class="n">X</span><span class="o">-</span><span class="n">Real</span><span class="o">-</span><span class="n">IP</span><span class="w"> </span><span class="n">$remote_addr</span><span class="p">;</span>
<span class="w">            </span><span class="n">proxy_set_header</span><span class="w"> </span><span class="n">X</span><span class="o">-</span><span class="n">Forwarded</span><span class="o">-</span><span class="n">For</span><span class="w"> </span><span class="n">$proxy_add_x_forwarded_for</span><span class="p">;</span>
<span class="w">            </span><span class="n">proxy_set_header</span><span class="w"> </span><span class="n">X</span><span class="o">-</span><span class="n">Forwarded</span><span class="o">-</span><span class="n">Proto</span><span class="w"> </span><span class="n">$scheme</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="embrq03">EMBRQ#03</h2>
<h2 id="embrq03-sensor-data-collection">EMBRQ#03 ‚Äî Sensor Data Collection</h2>
<p>The reader device integrates 4 types of sensors (DHT11, BMP180, BH1750, analog water sensor) to measure environmental data and upload it to the backend API via HTTPS. Each sensor is initialized and polled in the main loop, with results printed to the serial monitor and sent as a single payload to the API.</p>
<h3 id="loop">Loop</h3>
<p><strong>File:</strong> <code>sensors.ino</code> ‚Äî Lines ~119 <a href="https://github.com/YanisDeplazes/atmos/tree/main/embedded/final/sensors/sensors.ino?ref_type=heads#L119">Source</a></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">readDht11</span><span class="p">();</span>
<span class="w">  </span><span class="n">readBh1750</span><span class="p">();</span>
<span class="w">  </span><span class="n">readWaterSensor</span><span class="p">();</span>
<span class="w">  </span><span class="n">readBmp180</span><span class="p">();</span>
<span class="w">  </span><span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="reading-functions">Reading Functions</h3>
<p><strong>File:</strong> <code>sensors.ino</code> ‚Äî Lines ~134 <a href="https://github.com/YanisDeplazes/atmos/tree/main/embedded/final/sensors/sensors.ino?ref_type=heads#L134">Source</a></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">readDht11</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dht</span><span class="p">.</span><span class="n">readTemperature</span><span class="p">();</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">hum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dht</span><span class="p">.</span><span class="n">readHumidity</span><span class="p">();</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isnan</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span><span class="w"> </span><span class="n">sensorData</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isnan</span><span class="p">(</span><span class="n">hum</span><span class="p">))</span><span class="w"> </span><span class="n">sensorData</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hum</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">readBh1750</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">lux</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lightMeter</span><span class="p">.</span><span class="n">readLightLevel</span><span class="p">();</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lux</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">MIN_VALID_LUX</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">sensorData</span><span class="p">[</span><span class="n">IDX_BH1750_LUX</span><span class="p">].</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lux</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">readWaterSensor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">sensorData</span><span class="p">[</span><span class="n">IDX_WATER_ANALOG</span><span class="p">].</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analogRead</span><span class="p">(</span><span class="n">WATERPIN</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">readBmp180</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">bmpReady</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">  </span><span class="n">sensorData</span><span class="p">[</span><span class="n">IDX_BMP180_TEMP</span><span class="p">].</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bmp</span><span class="p">.</span><span class="n">readTemperature</span><span class="p">();</span>
<span class="w">  </span><span class="n">sensorData</span><span class="p">[</span><span class="n">IDX_BMP180_PRESSURE</span><span class="p">].</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bmp</span><span class="p">.</span><span class="n">readPressure</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">PA_TO_HPA_DIVISOR</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="used-libraries_2">Used Libraries</h3>
<ul>
<li><code>DHT</code> for temperature and humidity (DHT11)</li>
<li><code>Adafruit_BMP085</code> for temperature and pressure (BMP180)</li>
<li><code>BH1750</code> for ambient light (lux)</li>
<li><code>Wire</code> (I2C) for communication</li>
</ul>
<h2 id="embrq04">EMBRQ#04</h2>
<p>Both devices have output components (3 in total). They allow the for visually or audibly feedback from weather data.</p>
<ul>
<li>LED (Visualize when Setup is done)</li>
<li>WS2812B Ledstrip (Visualize Temperature)</li>
<li>Mini MP3 DFPlayer Player (Plays sound depending on weather)</li>
</ul>
<h3 id="led">LED</h3>
<p><strong>File:</strong> <code>sensors.ino</code> ‚Äî Lines ~111 <a href="https://github.com/YanisDeplazes/atmos/tree/main/embedded/final/sensors/sensors.ino?ref_type=heads#L111">Source</a></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="n">digitalWrite</span><span class="p">(</span><span class="n">WIFI_LED_PIN</span><span class="p">,</span><span class="w"> </span><span class="n">HIGH</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<h3 id="ws2812b-ledstrip">WS2812B Ledstrip</h3>
<p><strong>File:</strong> <code>LEDManager.cpp</code> ‚Äî Lines ~50 <a href="https://github.com/YanisDeplazes/atmos/tree/main/embedded/final/installation/LEDManager.cpp?ref_type=heads#L50">Source</a></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">initLEDs</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">FastLED</span><span class="p">.</span><span class="n">addLeds</span><span class="o">&lt;</span><span class="n">LED_TYPE</span><span class="p">,</span><span class="w"> </span><span class="n">LED_PIN</span><span class="p">,</span><span class="w"> </span><span class="n">LED_COLOR_ORDER</span><span class="o">&gt;</span><span class="p">(</span><span class="n">leds</span><span class="p">,</span><span class="w"> </span><span class="n">NUM_LEDS</span><span class="p">);</span>
<span class="w">  </span><span class="n">FastLED</span><span class="p">.</span><span class="n">setBrightness</span><span class="p">(</span><span class="n">LED_BRIGHTNESS</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>File:</strong> <code>LEDManager.cpp</code> ‚Äî Lines ~86 <a href="https://github.com/YanisDeplazes/atmos/tree/main/embedded/final/installation/LEDManager.cpp?ref_type=heads#L86">Source</a></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">showColor</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">temp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">CRGB</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">temp</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">TEMP_COLOR_THRESHOLD</span><span class="p">)</span>
<span class="w">                 </span><span class="o">?</span><span class="w"> </span><span class="n">interpolateColor</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">TEMP_COLOR_THRESHOLD</span><span class="p">,</span><span class="w"> </span><span class="n">TEMP_COLOR_MAX</span><span class="p">,</span><span class="w"> </span><span class="n">COLOR_WARM_MIN</span><span class="p">,</span><span class="w"> </span><span class="n">COLOR_WARM_MAX</span><span class="p">)</span>
<span class="w">                 </span><span class="o">:</span><span class="w"> </span><span class="n">interpolateColor</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">TEMP_COLOR_MIN</span><span class="p">,</span><span class="w"> </span><span class="n">TEMP_COLOR_THRESHOLD</span><span class="p">,</span><span class="w"> </span><span class="n">COLOR_COLD_MIN</span><span class="p">,</span><span class="w"> </span><span class="n">COLOR_COLD_MAX</span><span class="p">);</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LOOP_START_INDEX</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">NUM_LEDS</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">leds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">color</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">FastLED</span><span class="p">.</span><span class="n">show</span><span class="p">();</span>

<span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">"Static Temp Color ‚Üí R: %d, G: %d, B: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="p">.</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="p">.</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="p">.</span><span class="n">b</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="mini-mp3-dfplayer-player">Mini MP3 DFPlayer Player</h3>
<p><strong>File:</strong> <code>DFPlayerManager.cpp</code> ‚Äî Lines ~60 <a href="https://github.com/YanisDeplazes/atmos/tree/main/embedded/final/installation/DFPlayerManager.cpp#L60">Source</a></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">initDFPlayer</span><span class="p">(</span><span class="n">HardwareSerial</span><span class="o">*</span><span class="w"> </span><span class="n">serial</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">rx</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">dfSerial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">serial</span><span class="p">;</span>
<span class="w">  </span><span class="n">rxPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rx</span><span class="p">;</span>
<span class="w">  </span><span class="n">txPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tx</span><span class="p">;</span>

<span class="w">  </span><span class="n">dfSerial</span><span class="o">-&gt;</span><span class="n">begin</span><span class="p">(</span><span class="n">DFPLAYER_BAUDRATE</span><span class="p">,</span><span class="w"> </span><span class="n">SERIAL_8N1</span><span class="p">,</span><span class="w"> </span><span class="n">rxPin</span><span class="p">,</span><span class="w"> </span><span class="n">txPin</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">player</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="o">*</span><span class="n">dfSerial</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"DFPlayer init failed"</span><span class="p">);</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">);</span><span class="w"> </span><span class="c1">// Halt if initialization fails</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">setVolume</span><span class="p">(</span><span class="n">currentVolume</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>File:</strong> <code>DFPlayerManager.cpp</code> ‚Äî Lines ~L117 <a href="https://github.com/YanisDeplazes/atmos/tree/main/embedded/final/installation/DFPlayerManager.cpp#L117">Source</a></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">playTrack</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">track</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">track</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">lastTrackPlayed</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Playing new Track"</span><span class="p">);</span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">track</span><span class="p">);</span>
<span class="w">    </span><span class="n">player</span><span class="p">.</span><span class="n">loop</span><span class="p">(</span><span class="n">track</span><span class="p">);</span>
<span class="w">    </span><span class="n">lastTrackPlayed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">track</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="libraries-used">Libraries Used</h3>
<ul>
<li>DFRobotDFPlayerMini</li>
<li>FastLED</li>
</ul>
<h2 id="embrq05">EMBRQ#05</h2>
<p>Both devices use the WiFiManager library for the network setup.
If no credentials are stored, it launches a portal for configuration:</p>
<ul>
<li>No hardcoded credentials</li>
<li>Portal fallback</li>
<li>Auto-reconnect to known networks</li>
<li>Reboots if config times out</li>
</ul>
<p><strong>File:</strong> installation: <code>WiFiSetup.cpp</code> ‚Äî Lines ~21 <a href="https://github.com/YanisDeplazes/atmos/tree/main/embedded/final/sensors/WiFiSetup.cpp?ref_type=heads#L21">Source</a></p>
<p><strong>File:</strong> sensors: <code>WiFiSetup.cpp</code> ‚Äî Lines ~21 <a href="https://github.com/YanisDeplazes/atmos/tree/main/embedded/final/installation/WiFiSetup.cpp?ref_type=heads#L21">Source</a></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">connectToWiFi</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">wifiManager</span><span class="p">.</span><span class="n">setConfigPortalTimeout</span><span class="p">(</span><span class="n">PORTAL_TIMEOUT_SEC</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">wifiManager</span><span class="p">.</span><span class="n">autoConnect</span><span class="p">(</span><span class="n">WIFI_AP_NAME</span><span class="p">,</span><span class="w"> </span><span class="n">WIFI_AP_PASSWORD</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"WiFi connection failed. Restarting..."</span><span class="p">);</span>
<span class="w">    </span><span class="n">delay</span><span class="p">(</span><span class="n">RESTART_DELAY_MS</span><span class="p">);</span>
<span class="w">    </span><span class="n">ESP</span><span class="p">.</span><span class="n">restart</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"WiFi connected."</span><span class="p">);</span>
<span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"IP Address: "</span><span class="p">);</span>
<span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">localIP</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="libraries-used_1">Libraries Used</h3>
<ul>
<li>WiFiManager</li>
</ul></div>




  </div>
				</div>
			</main>
		</div>
	</article>
</div>

          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
     
	
      <script src="../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
     

  </body>
</html>